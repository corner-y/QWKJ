<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在院费用预审核</title>
    <link rel="stylesheet" href="../../../样式文件/通用样式.css">
    <link rel="stylesheet" href="../../../样式文件/事中审核样式.css">
    <link rel="stylesheet" href="../../../样式文件/unified-sidebar.css">
    </head>
<body>
    
    <div class="dashboard-container">
        <div id="sidebar-container"></div>
        
        <!-- 主内容区域 -->
        <div class="main-content">
            <!-- 顶部导航栏 -->
            <div class="top-navbar">
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="icon-menu"></i>
                </button>
                <div class="breadcrumb">
                    <span>审核管理</span>
                    <span class="separator">></span>
                    <span>事中审核</span>
                </div>
                <div class="navbar-actions">
                    <button class="btn btn-icon" onclick="showNotifications()">
                        <i class="icon-bell"></i>
                        <span class="badge">3</span>
                    </button>
                    <button class="btn btn-icon" onclick="refreshPage()">
                        <i class="icon-refresh"></i>
                    </button>
                    <div class="current-time" id="currentTime"></div>
                </div>
            </div>
            
            <div class="in-process-container">
        <div class="page-header">
            <h2>在院费用预审核</h2>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="batchCheck()">批量审核</button>
                <button class="btn btn-secondary" onclick="exportReport()">导出报告</button>
                <button class="btn btn-secondary" onclick="refreshData()">刷新数据</button>
            </div>
        </div>

        <!-- 统计概览 -->
        <div class="overview-section">
            <div class="overview-cards">
                <div class="overview-card total">
                    <div class="card-icon">
                        <i class="icon-patients"></i>
                    </div>
                    <div class="card-info">
                        <div class="card-value">156</div>
                        <div class="card-label">在院患者</div>
                    </div>
                    <div class="card-trend">较昨日 +8</div>
                </div>
                <div class="overview-card pending">
                    <div class="card-icon">
                        <i class="icon-pending"></i>
                    </div>
                    <div class="card-info">
                        <div class="card-value">23</div>
                        <div class="card-label">待审核</div>
                    </div>
                    <div class="card-trend">较昨日 +5</div>
                </div>
                <div class="overview-card risk">
                    <div class="card-icon">
                        <i class="icon-risk"></i>
                    </div>
                    <div class="card-info">
                        <div class="card-value">12</div>
                        <div class="card-label">高风险</div>
                    </div>
                    <div class="card-trend">较昨日 -2</div>
                </div>
                <div class="overview-card amount">
                    <div class="card-icon">
                        <i class="icon-amount"></i>
                    </div>
                    <div class="card-info">
                        <div class="card-value">¥2.3M</div>
                        <div class="card-label">总费用</div>
                    </div>
                    <div class="card-trend">较昨日 +12%</div>
                </div>
            </div>
        </div>

        <!-- 筛选条件 -->
        <div class="filter-section">
            <div class="filter-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>科室</label>
                        <select class="form-select" id="department">
                            <option value="">全部科室</option>
                            <option value="internal">内科</option>
                            <option value="surgery">外科</option>
                            <option value="pediatrics">儿科</option>
                            <option value="obstetrics">妇产科</option>
                            <option value="emergency">急诊科</option>
                            <option value="icu">ICU</option>
                            <option value="cardiology">心内科</option>
                            <option value="neurology">神经科</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>住院天数</label>
                        <select class="form-select" id="stayDays">
                            <option value="">全部</option>
                            <option value="1-3">1-3天</option>
                            <option value="4-7">4-7天</option>
                            <option value="8-15">8-15天</option>
                            <option value="16-30">16-30天</option>
                            <option value="30+">30天以上</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>费用范围</label>
                        <select class="form-select" id="costRange">
                            <option value="">全部</option>
                            <option value="0-5000">0-5千</option>
                            <option value="5000-10000">5千-1万</option>
                            <option value="10000-30000">1万-3万</option>
                            <option value="30000-50000">3万-5万</option>
                            <option value="50000+">5万以上</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>风险等级</label>
                        <select class="form-select" id="riskLevel">
                            <option value="">全部等级</option>
                            <option value="high">高风险</option>
                            <option value="medium">中风险</option>
                            <option value="low">低风险</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>审核状态</label>
                        <select class="form-select" id="auditStatus">
                            <option value="">全部状态</option>
                            <option value="pending">待审核</option>
                            <option value="checking">审核中</option>
                            <option value="completed">已完成</option>
                        </select>
                    </div>
                    <div class="form-group filter-actions">
                        <button class="btn btn-primary" onclick="applyFilter()">筛选</button>
                        <button class="btn btn-secondary" onclick="resetFilter()">重置</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 患者列表 -->
        <div class="patients-section">
            <div class="section-header">
                <div class="section-title">
                    <h3>在院患者列表</h3>
                    <span class="patient-count">共 156 名患者</span>
                </div>
                <div class="section-actions">
                    <div class="view-mode">
                        <button class="view-btn active" data-view="list">列表视图</button>
                        <button class="view-btn" data-view="card">卡片视图</button>
                    </div>
                    <div class="sort-options">
                        <label>排序</label>
                        <select class="form-select" id="sortBy">
                            <option value="risk">风险等级</option>
                            <option value="cost">费用金额</option>
                            <option value="days">住院天数</option>
                            <option value="time">入院时间</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 列表视图 -->
            <div class="patients-list-view" id="listView">
                <table class="table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll"></th>
                            <th>患者信息</th>
                            <th>科室/床位</th>
                            <th>住院信息</th>
                            <th>费用统计</th>
                            <th>风险等级</th>
                            <th>审核状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="patient-row high-risk">
                            <td><input type="checkbox" class="patient-checkbox" data-id="1"></td>
                            <td>
                                <div class="patient-info">
                                    <div class="patient-name">张某某</div>
                                    <div class="patient-details">
                                        <span class="patient-id">P20240115001</span>
                                        <span class="patient-age">65岁 男</span>
                                    </div>
                                    <div class="patient-insurance">职工医保</div>
                                </div>
                            </td>
                            <td>
                                <div class="department-info">
                                    <div class="department">心内科</div>
                                    <div class="bed">3床 (VIP病房)</div>
                                </div>
                            </td>
                            <td>
                                <div class="stay-info">
                                    <div class="admission-date">入院：2024-01-10</div>
                                    <div class="stay-days">住院：5天</div>
                                    <div class="diagnosis">急性心肌梗死</div>
                                </div>
                            </td>
                            <td>
                                <div class="cost-info">
                                    <div class="total-cost">¥45,680.50</div>
                                    <div class="daily-cost">日均：¥9,136</div>
                                    <div class="cost-breakdown">
                                        <span>药费：¥12,500</span>
                                        <span>检查：¥8,900</span>
                                        <span>治疗：¥24,280</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="risk-level high">
                                    <div class="risk-indicator"></div>
                                    <span>高风险</span>
                                </div>
                                <div class="risk-reasons">
                                    <span class="risk-tag">费用超标</span>
                                    <span class="risk-tag">用药异常</span>
                                </div>
                            </td>
                            <td>
                                <div class="audit-status pending">
                                    <span class="status-text">待审核</span>
                                    <div class="status-time">2小时前</div>
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-xs btn-primary" onclick="startAudit(1)">开始审核</button>
                                    <button class="btn btn-xs btn-info" onclick="viewDetails(1)">详情</button>
                                    <button class="btn btn-xs btn-secondary" onclick="viewHistory(1)">历史</button>
                                </div>
                            </td>
                        </tr>
                        <tr class="patient-row medium-risk">
                            <td><input type="checkbox" class="patient-checkbox" data-id="2"></td>
                            <td>
                                <div class="patient-info">
                                    <div class="patient-name">李某某</div>
                                    <div class="patient-details">
                                        <span class="patient-id">P20240115002</span>
                                        <span class="patient-age">42岁 女</span>
                                    </div>
                                    <div class="patient-insurance">居民医保</div>
                                </div>
                            </td>
                            <td>
                                <div class="department-info">
                                    <div class="department">妇产科</div>
                                    <div class="bed">12床 (普通病房)</div>
                                </div>
                            </td>
                            <td>
                                <div class="stay-info">
                                    <div class="admission-date">入院：2024-01-12</div>
                                    <div class="stay-days">住院：3天</div>
                                    <div class="diagnosis">剖宫产术后</div>
                                </div>
                            </td>
                            <td>
                                <div class="cost-info">
                                    <div class="total-cost">¥8,950.00</div>
                                    <div class="daily-cost">日均：¥2,983</div>
                                    <div class="cost-breakdown">
                                        <span>药费：¥1,200</span>
                                        <span>检查：¥1,500</span>
                                        <span>治疗：¥6,250</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="risk-level medium">
                                    <div class="risk-indicator"></div>
                                    <span>中风险</span>
                                </div>
                                <div class="risk-reasons">
                                    <span class="risk-tag">检查频繁</span>
                                </div>
                            </td>
                            <td>
                                <div class="audit-status checking">
                                    <span class="status-text">审核中</span>
                                    <div class="status-time">30分钟前</div>
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-xs btn-warning" onclick="continueAudit(2)">继续审核</button>
                                    <button class="btn btn-xs btn-info" onclick="viewDetails(2)">详情</button>
                                    <button class="btn btn-xs btn-secondary" onclick="viewHistory(2)">历史</button>
                                </div>
                            </td>
                        </tr>
                        <tr class="patient-row low-risk">
                            <td><input type="checkbox" class="patient-checkbox" data-id="3"></td>
                            <td>
                                <div class="patient-info">
                                    <div class="patient-name">王某某</div>
                                    <div class="patient-details">
                                        <span class="patient-id">P20240115003</span>
                                        <span class="patient-age">28岁 男</span>
                                    </div>
                                    <div class="patient-insurance">职工医保</div>
                                </div>
                            </td>
                            <td>
                                <div class="department-info">
                                    <div class="department">外科</div>
                                    <div class="bed">8床 (普通病房)</div>
                                </div>
                            </td>
                            <td>
                                <div class="stay-info">
                                    <div class="admission-date">入院：2024-01-13</div>
                                    <div class="stay-days">住院：2天</div>
                                    <div class="diagnosis">阑尾炎术后</div>
                                </div>
                            </td>
                            <td>
                                <div class="cost-info">
                                    <div class="total-cost">¥3,200.00</div>
                                    <div class="daily-cost">日均：¥1,600</div>
                                    <div class="cost-breakdown">
                                        <span>药费：¥800</span>
                                        <span>检查：¥600</span>
                                        <span>治疗：¥1,800</span>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div class="risk-level low">
                                    <div class="risk-indicator"></div>
                                    <span>低风险</span>
                                </div>
                            </td>
                            <td>
                                <div class="audit-status completed">
                                    <span class="status-text">已完成</span>
                                    <div class="status-time">1小时前</div>
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-xs btn-success" onclick="viewAuditResult(3)">查看结果</button>
                                    <button class="btn btn-xs btn-info" onclick="viewDetails(3)">详情</button>
                                    <button class="btn btn-xs btn-secondary" onclick="viewHistory(3)">历史</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 卡片视图 -->
            <div class="patients-card-view" id="cardView" style="display: none;">
                <div class="patient-cards">
                    <div class="patient-card high-risk">
                        <div class="card-header">
                            <div class="patient-basic">
                                <div class="patient-name">张某某</div>
                                <div class="patient-meta">65岁 男 | P20240115001</div>
                            </div>
                            <div class="risk-badge high">高风险</div>
                        </div>
                        <div class="card-content">
                            <div class="card-info-row">
                                <div class="info-item">
                                    <label>科室床位</label>
                                    <span>心内科 3床</span>
                                </div>
                                <div class="info-item">
                                    <label>住院天数</label>
                                    <span>5天</span>
                                </div>
                            </div>
                            <div class="card-info-row">
                                <div class="info-item">
                                    <label>总费用</label>
                                    <span class="cost-amount">¥45,680.50</span>
                                </div>
                                <div class="info-item">
                                    <label>日均费用</label>
                                    <span>¥9,136</span>
                                </div>
                            </div>
                            <div class="card-diagnosis">
                                <label>诊断</label>
                                <span>急性心肌梗死</span>
                            </div>
                            <div class="card-risks">
                                <span class="risk-tag">费用超标</span>
                                <span class="risk-tag">用药异常</span>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="audit-status pending">待审核</div>
                            <div class="card-actions">
                                <button class="btn btn-xs btn-primary">开始审核</button>
                                <button class="btn btn-xs btn-info">详情</button>
                            </div>
                        </div>
                    </div>
                    <!-- 更多卡片... -->
                </div>
            </div>

            <!-- 批量操作 -->
            <div class="batch-actions">
                <div class="batch-info">
                    <span id="selectedCount">已选择 0 名患者</span>
                </div>
                <div class="batch-buttons">
                    <button class="btn btn-primary" onclick="batchAudit()" disabled>批量审核</button>
                    <button class="btn btn-secondary" onclick="batchExport()" disabled>批量导出</button>
                    <button class="btn btn-warning" onclick="batchAlert()" disabled>批量预警</button>
                </div>
            </div>

            <!-- 分页 -->
            <div class="pagination">
                <div class="pagination-info">
                    显示第 1-20 名患者，共 156 名
                </div>
                <div class="pagination-controls">
                    <button class="btn btn-sm btn-secondary" disabled>上一页</button>
                    <div class="page-numbers">
                        <button class="page-btn active">1</button>
                        <button class="page-btn">2</button>
                        <button class="page-btn">3</button>
                        <button class="page-btn">4</button>
                        <button class="page-btn">5</button>
                        <span class="page-ellipsis">...</span>
                        <button class="page-btn">8</button>
                    </div>
                    <button class="btn btn-sm btn-secondary">下一页</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 审核弹窗 -->
    <div class="modal" id="auditModal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>费用预审核</h3>
                <button class="modal-close" onclick="closeAuditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="audit-content" id="auditContent">
                    <!-- 审核内容将动态加载 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAuditModal()">取消</button>
                <button class="btn btn-success" onclick="approveAudit()">通过</button>
                <button class="btn btn-warning" onclick="warnAudit()">警告</button>
                <button class="btn btn-danger" onclick="rejectAudit()">拒绝</button>
            </div>
            </div>
        </div>
    </div>

    <script src="../assets/js/operator-dashboard.js"></script>
    <script src="../assets/js/in-process-check.js"></script>
        </div>
    </div>
    <!-- 加载统一菜单 -->
<script>
    // 加载统一菜单组件
    // 使用绝对路径确保正确加载侧边栏组件
    fetch('/1.0/超级管理员/组件/_unified-sidebar.html')
        .then(response => response.text())
        .then(html => {
            const sidebarContainer = document.getElementById('sidebar-container');
            sidebarContainer.innerHTML = html;
            // 手动执行插入的脚本
            const scripts = sidebarContainer.querySelectorAll('script');
            scripts.forEach(script => {
                const newScript = document.createElement('script');
                if (script.src) {
                    newScript.src = script.src;
                } else {
                    newScript.textContent = script.textContent;
                }
                document.head.appendChild(newScript);
                script.remove();
            });
            // 等待脚本执行后再初始化菜单
            setTimeout(() => {
                if (typeof initSidebar === 'function') {
                    initSidebar();
                }
            }, 100);
        })
        .catch(error => console.error('Error loading sidebar:', error));
</script>


</body>
</html>