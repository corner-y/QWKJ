<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>案例详情 - 医保审核系统</title>
    <link rel="stylesheet" href="/1.0/超级管理员/样式文件/unified-sidebar.css">
    <link rel="stylesheet" href="/1.0/样式文件/平台看板样式.css">
    <link rel="stylesheet" href="/1.0/样式文件/审核记录样式.css">
    <link rel="stylesheet" href="/1.0/样式文件/通用样式.css">
    <style>
        /* 案例详情页特定样式 */
        .detail-page-container {
            padding: 20px;
        }
        
        .page-header {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
            display: flex;
            align-items: center;
        }
        
        .page-subtitle {
            color: #7f8c8d;
            margin-top: 8px;
            font-size: 14px;
        }
        
        .case-id {
            font-size: 14px;
            color: #3498db;
            margin-left: 12px;
            background: #ebf5fb;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .back-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 20px;
            transition: background-color 0.2s ease;
        }
        
        .back-button:hover {
            background: #2980b9;
        }
        
        .detail-content {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
        }
        
        .info-panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .panel-header {
            background: #f8f9fa;
            padding: 16px 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .panel-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }
        
        .panel-content {
            padding: 20px;
        }
        
        .info-item {
            margin-bottom: 16px;
        }
        
        .info-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .info-value {
            font-size: 14px;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .info-divider {
            height: 1px;
            background: #e0e0e0;
            margin: 16px 0;
        }
        
        .treatment-record {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            border-left: 4px solid #3498db;
        }
        
        .treatment-date {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .treatment-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .treatment-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .treatment-item:last-child {
            border-bottom: none;
        }
        
        .treatment-name {
            font-size: 13px;
            color: #2c3e50;
            flex: 1;
        }
        
        .treatment-amount {
            font-size: 13px;
            color: #e74c3c;
            font-weight: 500;
        }
        
        .violation-info {
            background: #fff5f5;
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            border-left: 4px solid #e74c3c;
        }
        
        .violation-header {
            font-size: 14px;
            font-weight: 600;
            color: #c0392b;
            margin-bottom: 8px;
        }
        
        .violation-text {
            font-size: 13px;
            color: #34495e;
            line-height: 1.5;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-reviewing {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .btn-full-history {
            width: 100%;
            padding: 10px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }
        
        .btn-full-history:hover {
            background: #2980b9;
        }
        
        /* 响应式设计 */
        @media (max-width: 1200px) {
            .detail-content {
                grid-template-columns: 250px 1fr 300px;
            }
        }
        
        @media (max-width: 992px) {
            .detail-content {
                grid-template-columns: 1fr;
            }
            
            .info-panel {
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .detail-page-container {
                padding: 16px;
            }
            
            .page-header {
                padding: 20px;
            }
            
            .page-title {
                font-size: 20px;
            }
            
            .case-id {
                font-size: 12px;
                margin-left: 8px;
                padding: 2px 6px;
            }
        }
    </style>
</head>
<body>
    <!-- 引入统一侧边栏 -->
    <div id="sidebar-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-logo">医保审核系统</h2>
                <p class="sidebar-subtitle">超级管理员平台</p>
            </div>
            <div class="sidebar-nav">
                <!-- 侧边栏内容将通过脚本加载 -->
            </div>
        </div>
    </div>

    <!-- 主内容区域 -->
    <div class="main-content">
        <div class="detail-page-container">
            <button class="back-button" onclick="goBack()">← 返回上一页</button>
            
            <div class="page-header">
                <h1 class="page-title">案例详情 <span class="case-id">案例ID: <span id="currentCaseId">CS-001</span></span></h1>
                <p class="page-subtitle">详细的违规证据链展示</p>
            </div>

            <div class="detail-content">
                <!-- 左侧栏 - 案例基本信息 -->
                <div class="info-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">案例基本信息</h2>
                    </div>
                    <div class="panel-content">
                        <div class="info-item">
                            <div class="info-label">患者姓名</div>
                            <div class="info-value">王*</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">身份证号</div>
                            <div class="info-value">370************01X</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">就诊医院</div>
                            <div class="info-value">北京协和医院</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">就诊日期</div>
                            <div class="info-value">2024-10-15</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">主要诊断</div>
                            <div class="info-value">高血压（原发性）</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">医保类型</div>
                            <div class="info-value">城镇职工基本医疗保险</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">医疗费用总额</div>
                            <div class="info-value">¥ 1,280.00</div>
                        </div>
                        <div class="info-divider"></div>
                        <div class="info-item">
                            <div class="info-label">审核状态</div>
                            <div class="info-value">
                                <span class="status-badge status-pending">待审核</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">提交时间</div>
                            <div class="info-value">2024-10-16 09:30:45</div>
                        </div>
                    </div>
                </div>

                <!-- 中间栏 - 诊疗快照 -->
                <div class="info-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">诊疗快照</h2>
                    </div>
                    <div class="panel-content">
                        <div class="treatment-record">
                            <div class="treatment-date">2024-10-15 就诊记录</div>
                            <div class="treatment-details">
                                <div class="treatment-item">
                                    <div class="treatment-name">苯磺酸氨氯地平片(5mg)</div>
                                    <div class="treatment-amount">40片</div>
                                </div>
                                <div class="treatment-item">
                                    <div class="treatment-name">血常规检查</div>
                                    <div class="treatment-amount">1次</div>
                                </div>
                                <div class="treatment-item">
                                    <div class="treatment-name">血压监测</div>
                                    <div class="treatment-amount">1次</div>
                                </div>
                                <div class="treatment-item">
                                    <div class="treatment-name">医生诊疗费</div>
                                    <div class="treatment-amount">¥ 50.00</div>
                                </div>
                            </div>
                        </div>

                        <div class="treatment-record">
                            <div class="treatment-date">2024-09-20 就诊记录</div>
                            <div class="treatment-details">
                                <div class="treatment-item">
                                    <div class="treatment-name">苯磺酸氨氯地平片(5mg)</div>
                                    <div class="treatment-amount">30片</div>
                                </div>
                                <div class="treatment-item">
                                    <div class="treatment-name">血压监测</div>
                                    <div class="treatment-amount">1次</div>
                                </div>
                            </div>
                        </div>

                        <div class="violation-info">
                            <div class="violation-header">✋ 违规提示</div>
                            <div class="violation-text">
                                在2024-09-20至2024-10-15期间，该患者累计开具苯磺酸氨氯地平片70片，
                                平均每日使用量约2.33片，超过了正常的每日1片用量标准，且总用量超过35片的规则阈值。
                            </div>
                        </div>

                        <button class="btn-full-history" onclick="showFullHistory()">查看患者完整就诊史</button>
                    </div>
                </div>

                <!-- 右侧栏 - 违规判定详情 -->
                <div class="info-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">违规判定详情</h2>
                    </div>
                    <div class="panel-content">
                        <div class="info-item">
                            <div class="info-label">触发规则</div>
                            <div class="info-value">过度用药 - DR-001</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">规则名称</div>
                            <div class="info-value">苯磺酸氨氯地平片(5mg) - 30天超量</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">规则描述</div>
                            <div class="info-value" style="line-height: 1.5;">检测30天内开具该药品数量 > 35片的就诊记录。</div>
                        </div>
                        <div class="info-divider"></div>
                        <div class="info-item">
                            <div class="info-label">系统判定证据</div>
                            <div class="info-value" style="line-height: 1.5;">
                                系统检测到：该患者在2024-09-20至2024-10-15期间，累计开具'苯磺酸氨氯地平片'70片，
                                超出了35片的规则阈值。
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">异常指标</div>
                            <div class="info-value">
                                <div style="margin-bottom: 8px;">• 30天内总用量：70片（阈值：35片）</div>
                                <div>• 日均用量：2.33片（建议：1片）</div>
                            </div>
                        </div>
                        <div class="info-divider"></div>
                        <div class="info-item">
                            <div class="info-label">当前审核状态</div>
                            <div class="info-value">
                                <span class="status-badge status-pending">待审核</span>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">预计完成时间</div>
                            <div class="info-value">2024-10-20前</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 完整就诊史模态框 -->
    <div id="fullHistoryModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">患者完整就诊史</h2>
                <button class="modal-close" onclick="closeFullHistoryModal()">×</button>
            </div>
            <div class="modal-content">
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #2c3e50; margin-bottom: 8px;">患者信息</h4>
                    <p style="color: #34495e;">姓名：王* | 身份证号：370************01X | 性别：男 | 年龄：62岁</p>
                </div>
                
                <h3 style="margin-bottom: 16px; color: #2c3e50;">就诊记录列表</h3>
                <div class="table-wrapper">
                    <table class="detail-table">
                        <thead>
                            <tr>
                                <th>就诊日期</th>
                                <th>就诊医院</th>
                                <th>诊断</th>
                                <th>主要药品</th>
                                <th>费用总额</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2024-10-15</td>
                                <td>北京协和医院</td>
                                <td>高血压</td>
                                <td>苯磺酸氨氯地平片</td>
                                <td>¥ 1,280.00</td>
                            </tr>
                            <tr>
                                <td>2024-09-20</td>
                                <td>北京协和医院</td>
                                <td>高血压</td>
                                <td>苯磺酸氨氯地平片</td>
                                <td>¥ 980.00</td>
                            </tr>
                            <tr>
                                <td>2024-08-15</td>
                                <td>北京协和医院</td>
                                <td>高血压</td>
                                <td>苯磺酸氨氯地平片</td>
                                <td>¥ 950.00</td>
                            </tr>
                            <tr>
                                <td>2024-07-20</td>
                                <td>北京协和医院</td>
                                <td>高血压</td>
                                <td>苯磺酸氨氯地平片</td>
                                <td>¥ 980.00</td>
                            </tr>
                            <tr>
                                <td>2024-06-15</td>
                                <td>北京协和医院</td>
                                <td>高血压</td>
                                <td>苯磺酸氨氯地平片</td>
                                <td>¥ 950.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeFullHistoryModal()">关闭</button>
            </div>
        </div>
    </div>

    <script>
        // 加载统一侧边栏
        document.addEventListener('DOMContentLoaded', function() {
            // 加载统一侧边栏
            fetch('/1.0/超级管理员/组件/_unified-sidebar.html')
                .then(response => response.text())
                .then(html => {
                    document.querySelector('#sidebar-container .sidebar-nav').innerHTML = html;
                    
                    // 初始化侧边栏
                    if (typeof initSidebar === 'function') {
                        initSidebar();
                    } else {
                        // 如果没有现成的initSidebar函数，使用简单的初始化
                        simpleInitSidebar();
                    }
                })
                .catch(error => {
                    console.error('加载统一侧边栏失败:', error);
                });

            // 解析URL中的案例ID参数
            const urlParams = new URLSearchParams(window.location.search);
            const caseId = urlParams.get('caseId');
            if (caseId) {
                document.getElementById('currentCaseId').textContent = caseId;
                // 根据不同的案例ID加载不同的数据
                loadCaseData(caseId);
            }
        });

        // 简单的侧边栏初始化函数
        function simpleInitSidebar() {
            // 菜单展开/收起功能
            document.querySelectorAll('.nav-expandable').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const parent = this.closest('.nav-group, .nav-subgroup');
                    const submenu = parent.querySelector('.nav-submenu');
                    
                    if (submenu) {
                        parent.classList.toggle('expanded');
                        submenu.style.display = parent.classList.contains('expanded') ? 'block' : 'none';
                    }
                });
            });
        }

        // 根据案例ID加载不同的数据
        function loadCaseData(caseId) {
            // 这里可以根据不同的案例ID加载不同的数据
            // 目前使用的是静态数据，但可以扩展为从API获取
            console.log('加载案例数据:', caseId);
        }

        // 返回上一页
        function goBack() {
            window.history.back();
        }

        // 显示完整就诊史
        function showFullHistory() {
            document.getElementById('fullHistoryModal').style.display = 'flex';
        }

        // 关闭完整就诊史模态框
        function closeFullHistoryModal() {
            document.getElementById('fullHistoryModal').style.display = 'none';
        }

        // 点击模态框外部关闭模态框
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>